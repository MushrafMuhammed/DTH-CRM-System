{% extends 'adminapp/components-layout.html' %}
{% load static %}

{% block content %}
<section class="section dashboard">

  <!-- Third Row -->
  <div class="row">
    <div class="col-lg-12">

      <div class="card info-card customers-card">
        <div class="card-body">
          <div class="row">
            <div class="col-lg-6 table-title">
              <h5><i class="bi bi-arrow-left"></i> Lead List</h5>
            </div>
            <div class="col-lg-6 table-title btn-col">
              <button class="btn-refresh" onclick="refresh()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
              <form method="POST" enctype="multipart/form-data" class="d-flex">
                {% csrf_token %}
                <input class="form-control form-control-sm input_excel" id="formFileSm" type="file" name="excel_file">
                <button class="btn-green " type="submit">
                  <i class="bi bi-download"></i> Import Lead
                </button>
              </form>
              <button class="btn-blue" data-toggle="modal" data-target="#exampleModalCenter">Add New Lead</button>
              <a href="{% url 'adminapp:lead_assign' %}" type="button" class="bt">Assign</a>
            </div>
          </div>

          <div class="row">
            <table class="table">
              <thead class="table-light">
                <tr>
                  <th scope="col">Type</th>
                  <th scope="col">Name</th>
                  <th scope="col">Lead_Status</th>
                  <th scope="col">Source</th>
                  <th scope="col">Country</th>
                  <th scope="col">Phone</th>
                  <th scope="col">Email</th>
                  <th scope="col">Work Status</th>
                  <th scope="col">Telecaller</th>
                  <th scope="col"></th>
                </tr>
              </thead>

              <tbody>
                {% for lead in leads_list %}
                <tr>
                  <td hidden>{{lead.id}}</td>
                  <td scope="row">{{lead.type}}</td>
                  <td>{{lead.name}}</td>
                  <td>{{lead.lead_status}}</td>
                  <td>{{lead.source}}</td>
                  <td>{{lead.country}}</td>
                  <td>{{lead.phone}}</td>
                  <td>{{lead.email}}</td>
                  <td>{{lead.status}}</td>
                  <td>{{lead.telecaller.name}}</td>
                  <td>
                    <button type="button" class="edit_btn btn btn-primary" data-toggle="modal"
                      data-target="#exampleModalCenter"><i class="bi bi-pencil-square"></i></button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div><!-- End Table Row -->
        </div><!-- End Card Body -->
      </div>
    </div>
  </div><!-- End Third Row -->
</section>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <form id="submitLead">

        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Add New Lead</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <input type="hidden" id="inputId">
        <div class="modal-body">
          <div class="form-group row mb-2">
            <label for="inputType" class="col-sm-2 col-form-label">Type</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputType" required>
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputname" class="col-sm-2 col-form-label">Name</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputName" required>
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputLead_status" class="col-sm-2 col-form-label">Lead Status</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputLead_status" required>
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputSource" class="col-sm-2 col-form-label">Source</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputSource" required>
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputcountry" class="col-sm-2 col-form-label">Country</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputCountry" required>
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputPhone" class="col-sm-2 col-form-label">Phone</label>
            <div class="col-sm-10">
              <input type="tel" class="form-control" id="inputPhone" required pattern="[0-9]{10,}"
                title="Please enter a valid phone number">
            </div>
          </div>
          <div class="form-group row mb-2">
            <label for="inputEmail" class="col-sm-2 col-form-label">Email</label>
            <div class="col-sm-10">
              <input type="email" class="form-control" id="inputEmail" required>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" id="modal_btn" class="btn btn-primary" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!-- Jquery CDN -->

<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
  crossorigin="anonymous"></script>

<script>
  // Individual Lead Submission
  $(document).ready(function () {
    $('#submitLead').submit(function (event) {
      event.preventDefault();

      var id = sessionStorage.getItem("admin_sessionID");
      var type = $('#inputType').val();
      var name = $('#inputName').val();
      var lead_status = $('#inputLead_status').val();
      var source = $('#inputSource').val();
      var country = $('#inputCountry').val();
      var phone = $('#inputPhone').val();
      var email = $('#inputEmail').val();

      // send AJAX request to server
      $.ajax({
        url: '/adminapp/add_lead/',
        type: 'POST',
        data: {
          id: id,
          type: type,
          lead_status: lead_status,
          source: source,
          country: country,
          name: name,
          phone: phone,
          email: email,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },

        success: function (response) {
          alert(response.message)
          window.location.reload();
        },
        error: function (error) {
          alert(error.message)

        }
      });
    });
  });

  // Indivitual lead Edit
  $(document).ready(function () {
    $('.edit_btn').click(function () {
      var row = $(this).closest('tr');

      var id = row.find('td:eq(0)').text();
      var type = row.find('td:eq(1)').text();
      var name = row.find('td:eq(2)').text();
      var status = row.find('td:eq(3)').text();
      var source = row.find('td:eq(4)').text();
      var country = row.find('td:eq(5)').text();
      var phone = row.find('td:eq(6)').text();
      var email = row.find('td:eq(7)').text();

      // Populate the modal with data
      $('#exampleModalCenter #inputId').val(id);
      $('#exampleModalCenter #inputType').val(type);
      $('#exampleModalCenter #inputName').val(name);
      $('#exampleModalCenter #inputLead_status').val(status);
      $('#exampleModalCenter #inputSource').val(source);
      $('#exampleModalCenter #inputCountry').val(country);
      $('#exampleModalCenter #inputPhone').val(phone);
      $('#exampleModalCenter #inputEmail').val(email);
    });
  });

  // This will refresh the page
  function refresh() {
    window.location.reload();
  }

  // Show the alert if there is a message
  {% if success_message %}
  alert("{{ success_message }}");
  {% endif %}

  {% if error_message %}
  alert("{{ error_message }}");
  {% endif %}
</script>



{% endblock %}